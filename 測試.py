import json
import google.generativeai as genai
import os

api_key = 'AIzaSyBCcg0skdWwwG-hBucIvDCLHY9FFtzw9-0'
genai.configure(api_key=api_key)
model = genai.GenerativeModel('gemini-pro')

def face(input_data):
    item_counts = {
        "黃樺裕": 0,
        "羅詠琳": 0,
        "莊佩蓁": 0,
    }
    
    # 確保 input_data 是可迭代的
    for item in input_data:
        if isinstance(item, dict):
            if item["name"] == "Huang" and item["confidence"] > 0.5:
                item_counts["黃樺裕"] += 1
            elif item["name"] == "Irene" and item["confidence"] > 0.5:
                item_counts["羅詠琳"] += 1
            elif item["name"] == "Paney" and item["confidence"] > 0.5:
                item_counts["莊佩蓁"] += 1
    
    # 只保留數量大於 0 的項目
    fitem = {item: count for item, count in item_counts.items() if count > 0}
    
    # 構建結果字符串，僅包含物品名稱
    result = "、".join(f"{item}" for item in fitem.keys())
    ans = "畫面中有" + result
    return ans

# 測試資料
a = [
    {"name": "Huang", "confidence": 0.6877386840481583}
]
b = [
    {"name": "Paney", "confidence": 0.6877386840481583},
]
c = [
    {"name": "Paney", "confidence": 0.6877386840481583},
]
d = [
    {"name": "Paney", "confidence": 0.6877386840481583},
]
e = [
    {"name": "Paney", "confidence": 0.6877386840481583},
]

x=("結果一:"+face(a)+"\n，結果二:"+face(b)+ "\n，結果三:"+face(c)+"\n，結果四:"+face(d)+"\n，結果五:"+face(e))
print(x)
response = model.generate_content("現在一共有三個人，分別是黃樺裕、羅詠琳、莊佩蓁，接下來會有五個結果敘述出畫面中這三個人是否存在，每一個人都有存在跟不存在兩個狀態，畫面中沒有提到即代表不存在，同一個人在不同結果中可能會有不同狀態，請綜合所有結果，以多數為真的邏輯，只要一個結果出現次出在三次以上即為真，整合出最終答案，以下中括號中的文字為例題:[結果一:畫面中有黃樺裕、莊佩蓁，結果二:畫面中有黃樺裕、莊佩蓁，結果三:畫面中有莊佩蓁，結果四:畫面中有羅詠琳、莊佩蓁，結果五:畫面中有羅詠琳、莊佩蓁]以下中括號部分為思考過程，接下來請完全參考此過程作答[判斷黃樺裕:三個結果中黃樺裕存在，兩個結果顯示黃樺裕不存在，因為黃樺裕存在出現了三次，所以判斷黃樺裕存在為真，所以判斷畫面中有黃樺裕；判斷羅詠琳:兩個結果中羅詠琳存在，三個結果顯示羅詠琳不存在，因為羅詠琳不存在的結果在三以上，所以判斷畫面中沒有羅詠琳，由於羅詠琳不存在，則最後答案中不用顯示；判斷莊佩蓁:四個結果中莊佩蓁存在，一個結果顯示莊佩蓁不存在，因為最多結果顯示莊佩蓁存在，顯示莊佩蓁存在的結果在三以上，所以判斷畫面中有莊佩蓁；判斷完所有物品即可整合出答案:畫面中有黃樺裕、莊佩蓁。以下為題目，請參考剛剛的思考流程整合結果，再次強調，我需要的是重複次數最多的答案，這是你剛剛的錯誤案例；結果一:畫面中有羅詠琳，結果二:畫面中有羅詠琳，結果三:畫面中有羅詠琳，結果四:畫面中有黃樺裕、莊佩蓁，結果五:畫面中有羅詠琳、莊佩蓁。你的錯誤回答為:畫面中有黃樺裕，依照案例中五個結果，根據多數為真的邏輯，正確回答應該是:畫面中有羅詠琳。錯誤案例2:結果一:畫面中有黃樺裕，結果二:畫面中有黃樺裕，結果三:畫面中有羅詠琳，結果四:畫面中有黃樺裕，結果五:畫面中有羅詠琳、莊佩蓁。你的錯誤回答:畫面中有羅詠琳，根據多數為真，案例中三個結果黃樺裕存在，三個結果羅詠琳不存在，四個結果莊佩蓁不存在，以上為真，當不存在的結果的數量在三以上時，就不要回報給使用者，因此答案應該為:畫面中有黃樺裕。請記住，剛剛的只是例子，只能參考案例中答題的答題邏輯，接下來請根據這個答題邏輯幫我隱藏過程，回答現在的情況:"+x)
print(response.text)
p=input("輸入問題:")
q=model.generate_content("請幫我進行文字的校正，校正的部分主要是人名:[莊佩蓁、黃樺裕、羅詠琳]三個名字，等等輸入的問題可能人名中會有錯字，例如可能輸入值為:「我的前方有裝配針嗎」，就請幫我輸出:「我的前方有莊佩蓁嗎」，另外兩個人名同理，除了人名需要校正以外，輸入值的其他字請保持原樣。接下來為輸入值:"+p).text
print(q)
response = model.generate_content("莊佩蓁、黃樺裕、羅詠琳皆為使用者認識的人，例如使用者可能會問:莊佩蓁在我的前面嗎，如果畫面中有莊佩蓁的話，就要回答，是的莊佩蓁在您的前面。請根據此回答問題，請回答完整句子，如果畫面中沒有該人，就請回答沒有。這是你剛剛的錯誤案例:在這個案例中的畫面中有黃樺裕、莊佩蓁，案例的問題為:這附近有我認識的人嗎，你的錯誤回答為:是的，莊佩蓁在您的前面。在你的回答中，你忽略了黃樺裕也在你的畫面中，他們三個都是使用者認識的人，因此只要有出現就要回報給使用者，畫面中沒提到羅詠琳，代表他不存在，因此正確的回答為:有，黃樺裕跟莊佩蓁在您的前方。此為剛剛的對話紀錄:現在畫面中有黃樺裕、莊佩蓁。問題:誰在我的前方。你的回答:莊佩蓁在您的前方，看起來你又忽略了畫面中有的黃樺裕，請記住，只要畫面中有提到的都必須回報給使用者，之後請記得修正這個問題，正確回答應該為:目前莊佩蓁跟黃樺裕在您的前方。請記住，剛剛的只是例子，只能參考案例中答題的邏輯，接下來請根據畫面中的資訊「現在"+response.text+"」來回答問題，此為使用者前方的畫面，現在使用者的問題為:"+q)
print(response.text)



